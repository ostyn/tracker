<template>
  <div
    if.bind="activePopoverId"
    class="overlay"
    click.trigger="activePopoverId=undefined"
  ></div>
  <require from="./activity-grid.css"></require>
  <require from="resources/elements/activity/activity"></require>
  <div class="grid-controls">
    <span
      if.bind="!search"
      class="grid-button"
      click.trigger="search = !search"
    >
      <feather-icon name="search"></feather-icon>
      ${searchTerm?'"'+searchTerm+'"':""}
    </span>
    <input
      value.bind="searchTerm"
      blur.trigger="search = false"
      if.bind="search"
      placeholder="search"
      focus.bind="search"
      role="search"
      class="inline"
    />
    <span
      if.bind="searchTerm && !search"
      class="grid-button"
      click.trigger="searchTerm = ''"
    >
      <feather-icon name="x-circle"></feather-icon>
    </span>
    <span class="grid-button" click.trigger="toggleShowArchived()">
      <feather-icon if.bind="filterArchived" name="eye-off"></feather-icon>
      <feather-icon else name="eye"></feather-icon>
    </span>
    <span class="grid-button" click.trigger="toggleGroup()">
      <feather-icon if.bind="groupActivities" name="server"></feather-icon>
      <feather-icon else name="align-justify"></feather-icon>
    </span>
  </div>
  <article repeat.for="header of getSortedHeaders(categoryToActivityList)">
    <h2 class="group-header">${header}</h2>
    <activity
      repeat.for="activity of categoryToActivityList.get(header)"
      click.trigger="activityClick($event,activity)"
      long-click.trigger="activityLongClick($event, activity)"
      id.bind="activity.id"
      detail.bind="modCount?selectedActivityInfo.get(activity.id):undefined"
      class.bind="`clickable ${activePopoverId === activity.id?'selectedActivity':''} ${activity.isArchived ? 'disabled':''} ${modCount&& selectedActivityInfo.has(activity.id)?'selected-item':''}`"
    >
      <div class="popover" if.bind="activePopoverId === activity.id">
        <span class="up-arrow"></span>
        <h2>${activity.name}</h2>
        <button
          class="outline contrast"
          click.trigger="addDetails($event, activity)"
        >
          add details
        </button>
        <span
          if.bind="modCount?!isArray(selectedActivityInfo.get(activity.id)): undefined"
        >
          <button click.trigger="adjust(activity, 1)" class="inline">+1</button>
          <button click.trigger="adjust(activity, -1)" class="inline">
            -1
          </button>
          <button click.trigger="adjust(activity, 0.5)" class="inline">
            +0.5
          </button>
          <button click.trigger="adjust(activity, 0.25)" class="inline">
            +0.25
          </button>
        </span>
        <button class="contrast" click.trigger="clear(activity)">clear</button>
      </div>
    </activity>
    <span click.trigger="createNewActivity(header)">
      <feather-icon name="plus-circle"></feather-icon>
    </span>
  </article>
</template>
