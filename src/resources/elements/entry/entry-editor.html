<template>
  <require from="./entry-editor.css"></require>
  <require from="resources/elements/activity/activity-grid"></require>
  <require
    from="resources/elements/activity/activity-grid-loading.html"
  ></require>
  <require from="resources/elements/activity/activity-loading.html"></require>
  <require from="resources/elements/activity/activity"></require>
  <activity-grid-loading
    if.bind="!activityService.isLoaded"
  ></activity-grid-loading>
  <section
    class="entry-editor-buttons"
    if.bind="activityService.isLoaded && !isLoadingEntry"
  >
    <article class="note-preview" click.trigger="openTextPrompt()">
      <span>${workingCopy.note || "enter note here..." }</span>
      <feather-icon class="note-icon" name="file-text"></feather-icon>
    </article>
    <div>
      <input
        type="date"
        class="inline"
        value.bind="workingCopy.date"
        max.bind="date"
        name=""
      />
      <span class="mood-icon" click.trigger="openMoodPrompt()">
        ${getMood(workingCopy.mood).emoji}
      </span>
    </div>
  </section>
  <article class="activity-drawer" if.bind="workingCopy.activities.size">
    <activity-loading
      class="drawer-activity-loading"
      if.bind="isLoadingEntry || !activityService.isLoaded"
      repeat.for="1 of 10"
    >
    </activity-loading>
    <activity
      show-name.bind="false"
      if.bind="activityService.isLoaded && !isLoadingEntry"
      repeat.for="[id, detail] of workingCopy.activities"
      class="drawer-activity"
      click.trigger="removeActivity(id)"
      long-click.trigger="longPress(id)"
      id.bind="id"
      detail.bind="detail"
    ></activity>
  </article>

  <activity-grid
    if.bind="activityService.isLoaded"
    activities.bind="activities"
    on-activity-click.call="addActivity(activity.id)"
    on-activity-long-click.call="longPress(activity.id)"
  ></activity-grid>
  <div class="sticky-buttons">
    <button
      class="inline contrast"
      click.trigger="deleteEntry()"
      if.bind="entry.id"
    >
      <feather-icon name="trash-2"></feather-icon>
    </button>
    <button class="inline" click.trigger="submitEntry()">
      <feather-icon name="save"></feather-icon>
    </button>
  </div>
</template>
